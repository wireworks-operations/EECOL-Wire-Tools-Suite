<!--V0.6.8 INTEGRATED ADVANCED CUT RECORDS
Merged full-featured cut record tool with search, filtering, statistics, enhanced import/export, feedback page, advanced sorting, auto backup-->
<!DOCTYPE html>
<html lang="en">

<head>
    <!-- PWA Manifest -->
    <link rel="manifest" href="../../../src/assets/manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://fonts.googleapis.com; font-src https://fonts.googleapis.com; img-src 'self' data:;">
    <title>EECOL Wire Cut Stop Mark Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Global variables for cut records
        let cutRecords = [];
        let editingId = null;
        let currentView = 'records'; // 'records', 'documentation', 'credits'
        let displayedRecordsCount = 0;
        let recordsPerPage = 25;
        let isLoading = false;
        let currentSortField = 'timestamp'; // Default sort by timestamp
    </script>
    <!-- Shared CSS Theme -->
    <link rel="stylesheet" href="../../../src/assets/css/eecol-theme.css">

    <!-- Core Dependencies -->
    <script src="../../utils/theme-loader.js"></script>
    <script src="../../../src/core/database/indexeddb.js"></script>
    <script src="../../../src/utils/modals.js"></script>
    <script src="../../../src/utils/print.js"></script>
    <script src="../../../src/utils/mobile-menu.js"></script>

    <!-- PWA Core removed - install prompts only on index pages -->
</head>

<body class="p-3 sm:p-6 h-screen flex flex-col eecol-blue-bg relative">

    <div
        class="flex-1 w-full max-w-md md:max-w-xl lg:max-w-7xl xl:max-w-9xl bg-white p-4 sm:p-6 rounded-xl shadow-2xl mx-auto border-2 border-solid border-[#0058B3] overflow-hidden flex flex-col mb-16">

        <div class="flex justify-center mb-1">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                class="text-[#0058B3] drop-shadow-lg eecol-logo-tilt">
                <circle cx="12" cy="12" r="11.35" fill="white" stroke="currentColor" stroke-width="2" />
                <rect x="4" y="4" width="4" height="16" rx="1" fill="currentColor" />
                <path d="M 8,6.5 C 12,5.5 16,7.5 20,6.5" stroke="currentColor" stroke-width="3.5"
                    stroke-linecap="round" />
                <path d="M 8,12 C 12,11 16,13 20,12" stroke="currentColor" stroke-width="3.5" stroke-linecap="round" />
                <path d="M 8,17.5 C 12,16.5 16,18.5 20,17.5" stroke="currentColor" stroke-width="3.5"
                    stroke-linecap="round" />
            </svg>
        </div>

        <h1 class="text-3xl font-black mb-3 text-center header-gradient" id="toolTitle">
            EECOL Wire Cut Stop Mark Tool
        </h1>
        <p class="mb-5 text-center text-sm font-medium text-[#0058B3]" id="toolSubtitle">
            Calculate the stopping mark using flexible input and output units.
        </p>

        <div class="flex-1 overflow-y-auto">
            <div class="flex flex-col pb-4">

                <div id="leftColumn" class="space-y-6">

                    <!-- Tool Container: Wire Cut Stop Mark Tool -->
                    <div class="space-y-4">

                        <div class="p-3 bg-indigo-50/70 border-l-4 border-indigo-500 rounded-lg shadow-md">
                            <p class="text-xs font-semibold text-indigo-800">
                                CUT MARK PROTOCOL: For **Scenario 1 (Mark at Tip)**, always prefer to cut **JUST
                                BEFORE** the next mark digit to maintain mark consistency. See Knowledgebase for
                                Scenario 2 details.
                            </p>
                        </div>

                        <div class="shadow-md rounded-xl p-2 bg-white">
                            <label for="startValue" class="block text-xs font-semibold mb-1 text-[#0058B3]">Starting
                                Mark on Wire</label>
                            <div class="flex flex-col space-y-1 sm:flex-row sm:space-x-1 sm:space-y-0">
                                <input type="number" id="startValue" value="0"
                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-indigo-300 focus:border-indigo-500 transition duration-150 shadow-inner text-sm">
                                <select id="startUnit"
                                    class="w-full sm:w-auto p-2 border border-gray-300 rounded-lg bg-white shadow-sm font-medium text-[#0058B3] text-sm">
                                    <option value="m">Meters (m)</option>
                                    <option value="ft">Feet (ft)</option>
                                </select>
                            </div>
                        </div>

                        <div class="shadow-md rounded-xl p-2 bg-white">
                            <label for="cutLengthValue" class="block text-xs font-semibold mb-1 text-[#0058B3]">Length
                                to Cut</label>
                            <div class="flex flex-col space-y-1 sm:flex-row sm:space-x-1 sm:space-y-0">
                                <input type="number" id="cutLengthValue" value="0"
                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-indigo-300 focus:border-indigo-500 transition duration-150 shadow-inner text-sm">
                                <select id="cutLengthUnit"
                                    class="w-full sm:w-auto p-2 border border-gray-300 rounded-lg bg-white shadow-sm font-medium text-[#0058B3] text-sm">
                                    <option value="m">Meters (m)</option>
                                    <option value="ft">Feet (ft)</option>
                                </select>
                            </div>
                        </div>

                        <div class="shadow-md rounded-xl p-2 bg-white flex flex-col gap-4">
                            <div class="flex-1">
                                <label for="markingReference"
                                    class="block text-xs font-semibold mb-1 text-[#0058B3]">Marking Reference (Relative
                                    to Machine Zero)</label>
                                <select id="markingReference"
                                    class="w-full p-2 border border-gray-300 rounded-lg bg-white shadow-sm font-medium text-[#0058B3] text-sm">
                                    <option value="zero">At the Tip (No Offset)</option>
                                    <option value="offset_meter">1 Meter In (1 Meter Offset)</option>
                                    <option value="offset_foot">1 Foot In (1 Foot Offset)</option>
                                    <option value="custom">Custom Offset</option>
                                </select>
                                <p id="offsetNote" class="text-xs text-gray-500 mt-1">The offset unit (1 ft or 1 m) is
                                    based on the 'Starting Mark' unit.</p>
                            </div>
                            <div class="flex-1">
                                <label class="block text-xs font-semibold mb-1 text-[#0058B3] invisible">Custom Offset
                                    Value & Unit</label>
                                <div class="flex space-x-1">
                                    <input type="number" id="customOffsetInput"
                                        class="flex-1 p-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed shadow-inner text-sm"
                                        disabled placeholder="Value" min="0" step="any" />
                                    <select id="customOffsetUnit"
                                        class="flex-auto p-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed shadow-sm font-medium text-[#0058B3] text-sm"
                                        disabled>
                                        <option value="m">m</option>
                                        <option value="ft">ft</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="shadow-md rounded-xl p-2 bg-white">
                            <label for="countingDirection"
                                class="block text-xs font-semibold mb-1 text-[#0058B3]">Marking Direction</label>
                            <select id="countingDirection"
                                class="w-full p-2 border border-gray-300 rounded-lg bg-white shadow-sm font-medium text-[#0058B3] text-sm">
                                <option value="up">Counting Up (Additive)</option>
                                <option value="down">Counting Down (Subtractive)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Determines if the cut length is added to or subtracted
                                from the starting mark.</p>
                        </div>

                        <div class="shadow-md rounded-xl p-2 bg-white">
                            <label for="counterDistanceValue"
                                class="block text-xs font-semibold mb-1 text-[#0058B3]">Counter-to-Reel Distance</label>
                            <div class="flex flex-col space-y-1 sm:flex-row sm:space-x-1 sm:space-y-0">
                                <input type="number" id="counterDistanceValue" value="0"
                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-indigo-300 focus:border-indigo-500 transition duration-150 shadow-inner text-sm">
                                <select id="counterDistanceUnit"
                                    class="w-full sm:w-auto p-2 border border-gray-300 rounded-lg bg-white shadow-sm font-medium text-[#0058B3] text-sm">
                                    <option value="m">Meters (m)</option>
                                    <option value="ft">Feet (ft)</option>
                                </select>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Distance between the counter sensor and the reel
                                spooling point.</p>
                        </div>

                        <div class="flex space-x-3 py-2 px-2">
                            <button id="calculateBtn"
                                class="w-full bg-[#0058B3] hover:bg-[#004a99] text-white font-bold p-3 rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-[#0058B3] focus:ring-opacity-50 text-sm">
                                CALCULATE STOPPING MARK
                            </button>
                            <button id="clearBtn"
                                class="px-3 py-2 bg-white border-2 border-[#0058B3] text-[#0058B3] font-bold rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-[#0058B3] focus:ring-opacity-50 min-w-max text-sm">
                                Clear
                            </button>
                        </div>

                        <!-- Result Display -->
                        <div id="wireCutResultContainer"
                            class="p-4 bg-white border-l-8 card-border-blue rounded-xl shadow-xl hidden">
                            <h3 class="text-lg font-bold mb-4 text-[#0058B3] text-center">Stop Mark Analysis</h3>

                            <!-- Primary Result: Stopping Mark -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 text-center">
                                <p id="resultTextPrimary" class="text-sm font-bold text-gray-600 mb-1">Stopping Mark</p>
                                <p id="stoppingMarkPrimary" class="text-3xl font-black text-[#0058B3]">0.000 ft</p>
                                <p id="stoppingMarkSecondary" class="text-sm font-medium text-gray-500 mt-1"></p>
                            </div>

                            <!-- Visual Reference Mark -->
                            <div class="bg-white border border-gray-200 rounded-lg p-3 mb-4 shadow-sm">
                                <p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">Visual Reference
                                    (At Reel)</p>
                                <div class="flex items-baseline justify-between">
                                    <span class="text-sm font-semibold text-gray-700">Mark Location:</span>
                                    <span id="visualMarkValue" class="text-xl font-bold text-[#0058B3]">0.000 ft</span>
                                </div>
                                <p id="visualMarkValueConverted" class="text-xs text-right text-gray-500 mt-1"></p>
                            </div>

                            <!-- Additional Reference Marks -->
                            <div class="bg-white border border-gray-200 rounded-lg p-3 mb-4 shadow-sm">
                                <p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">Additional
                                    Reference Marks</p>
                                <div id="referenceMarksList" class="space-y-2">
                                    <!-- Dynamic content will be inserted here -->
                                </div>
                            </div>

                            <!-- Mechanism Explanation -->
                            <div id="mechanismExplanation"
                                class="mt-2 p-3 bg-blue-50/50 border border-blue-100 rounded-lg hidden">
                                <h4 class="text-xs font-bold text-[#0058B3] mb-1 flex items-center">
                                    <span class="mr-1">‚öôÔ∏è</span> Mechanism Explanation
                                </h4>
                                <p class="text-xs text-gray-600 leading-relaxed">
                                    <strong>Mark at Counter:</strong> The exact point on the wire currently at the
                                    counter sensor.<br>
                                    <strong>Mark 1 Unit Upstream:</strong> The point on the wire 1 unit (ft/m) upstream
                                    (towards the reel) from the counter. This value represents the "next" mark coming
                                    towards the counter if pulling continues.
                                </p>
                            </div>
                            <p class="text-xs text-gray-700 mt-2 text-center">Conversion Factor Used: 1 m ‚âà 3.28084 ft
                            </p>

                            <div class="mt-4 flex justify-center space-x-2">
                                <button id="printResultsBtn"
                                    class="px-4 py-2 bg-[#0058B3] text-white font-bold rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-[#0058B3] focus:ring-opacity-50 text-sm">
                                    Print Results
                                </button>
                                <button id="saveForCuttingRecordsBtn"
                                    class="px-4 py-2 bg-emerald-600 text-white font-bold rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:bg-emerald-700 active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-emerald-600 focus:ring-opacity-50 text-sm disabled:bg-gray-400 disabled:cursor-not-allowed">
                                    Save for Cutting Records
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer inside main box -->
        <div class="mt-auto pt-4 border-t border-blue-200 hidden sm:block">
            <div class="flex justify-between items-center mb-2">
                <div class="flex space-x-3">
                    <a href="../../../src/pages/index/index.html"
                        class="px-3 py-1.5 bg-blue-600 border-2 border-blue-600 text-white font-bold rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:bg-blue-700 hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-blue-600 focus:ring-opacity-50 text-xs no-underline">üè†
                        Home</a>
                    <a id="usefulBtnInside" href="../../../src/pages/useful-tool/useful-tool.html"
                        class="px-3 py-1.5 bg-sky-500 border-2 border-sky-500 text-white font-bold rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:bg-sky-600 active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-sky-500 focus:ring-opacity-50 text-xs no-underline">
                        Is This Tool Useful?
                    </a>
                </div>
                <p class="text-xs text-gray-500 font-mono select-none">v0.8.0.3</p>
            </div>
            <p class="font-medium text-[#0058B3] text-center select-none mb-1">
                Made With ‚ù§Ô∏è By: Lucas and Cline ü§ñ
            </p>
            <p class="text-xs font-semibold header-gradient text-center select-none">
                EECOL Wire Tools 2025 - Enterprise Edition
            </p>
        </div>
    </div>

    <!-- Custom Modal for Alerts/Confirmations -->
    <div id="customModal" class="fixed inset-0 z-50 hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" id="modalBackdrop"></div>
        <div class="relative bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 border-2 border-[#0058B3] transform scale-95 opacity-0 transition-all duration-200 ease-out"
            id="modalContent">
            <div class="flex items-center justify-center mb-4">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                    class="eecol-logo-tilt">
                    <defs>
                        <linearGradient id="modalGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#0058B3;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#004a99;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="12" cy="12" r="11.35" fill="white" stroke="url(#modalGradient)" stroke-width="2" />
                    <rect x="4" y="4" width="4" height="16" rx="1" fill="url(#modalGradient)" />
                    <path d="M 8,6.5 C 12,5.5 16,7.5 20,6.5" stroke="url(#modalGradient)" stroke-width="3.5"
                        stroke-linecap="round" />
                    <path d="M 8,12 C 12,11 16,13 20,12" stroke="url(#modalGradient)" stroke-width="3.5"
                        stroke-linecap="round" />
                    <path d="M 8,17.5 C 12,16.5 16,18.5 20,17.5" stroke="url(#modalGradient)" stroke-width="3.5"
                        stroke-linecap="round" />
                </svg>
            </div>
            <h3 class="text-lg font-bold text-center mb-3 header-gradient" id="modalTitle">Notification</h3>
            <div class="text-sm text-gray-700 mb-6 whitespace-pre-line text-center" id="modalMessage">Message here...
            </div>
            <div class="flex justify-center space-x-3" id="modalButtons">
                <!-- Buttons will be dynamically added here -->
            </div>
        </div>
    </div>

    <script src="../../../src/assets/js/stop-mark-converter.js"></script>
    <script src="../../utils/dark-mode.js"></script>
</body>

</html>